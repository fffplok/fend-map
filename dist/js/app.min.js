!function(){"use strict";function o(){var o=document.getElementById("container-data"),e=document.getElementById("container-images"),t=o.getBoundingClientRect().left>=0?-o.clientWidth/2:0,n=e.getBoundingClientRect().height>0?e.clientHeight/2:0;return{offsetX:t,offsetY:n}}function e(){var o=document.getElementById("container-data"),e=o.getBoundingClientRect().left>=0?o.clientWidth:0,t=Math.max(document.documentElement.clientWidth,window.innerWidth);return console.log("getWidthInfoWin, w, oX:",t,e),t-e-110}function t(){var o=document.getElementById("map-canvas"),e={zoom:m,center:{lat:44.963324,lng:-93.26832},panControl:!1,zoomControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT,position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.HYBRID],style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!1,streetViewControl:!1,overviewMapControl:!1};r=new google.maps.Geocoder,c=new google.maps.InfoWindow({content:""}),google.maps.event.addListener(c,"closeclick",function(){l.meetupSelected(null)}),s=new google.maps.Map(o,e)}function n(o){this.src="https://farm"+o.farm+".staticflickr.com/"+o.server+"/"+o.id+"_"+o.secret+".jpg",this.title=o.title}function a(o,e){var t="m",n=200*e;this.name=o.name,this.city=o.city,this.id=t+n,this.description=o.description,this.marker,this.location={lat:o.lat,lng:o.lon},this.urlThumb=o.group_photo?o.group_photo.thumb_link:"img/not_available.svg",this.photos=o.photos?o.photos:[],this.strContent="<img src="+this.urlThumb+" title="+this.name+" alt="+this.name+">",this.strContent+="<h4>"+this.name+"</h4>",this.strContent+="<div>"+this.description+"</div>",this.addMarker(t,n)}function i(){var e=this,t=setTimeout(function(){console.log("failed to get meetup resources")},8e3),i=function(){$.ajax({url:"https://api.meetup.com/find/groups?key=617467255c2e7b9d7a1c7d1646a20&photo-host=public&location='"+e.location()+"'&page=20&sign=true",dataType:"jsonp",success:function(n){if(console.log("getMeetups success, self.location(), response.data:",e.location(),n.data),e.groups().length>0)for(;e.groups().length>0;)e.groups().shift().removeMarker();var i=$.map(n.data,function(o,e){return new a(o,e)});e.groups(i),e.toggleShowGroups(),r.geocode({address:e.location()},function(e,t){if(t===google.maps.GeocoderStatus.OK){s.setCenter(e[0].geometry.location),s.setZoom(m);var n=o();s.panBy(n.offsetX,n.offsetY),l()}else alert("Geocode was not successful for the following reason: "+t)}),clearTimeout(t)},error:function(o){console.log("error:",o)}}).done(function(o){}).fail(function(o){console.log("fail, response:",o)}).always(function(o){})},l=function(){$.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=705d79e848f4e7dad9f9f119378b199f&lat="+s.getCenter().lat()+"&lon="+s.getCenter().lng()+"&per_page=20&format=json&nojsoncallback=1",success:function(o){if(console.log("getImages success, self.location(), response:",e.location(),o),"ok"===o.stat){$("#slides");if(e.images().length>0)for(;e.images().length>0;)e.images().shift();var a=$.map(o.photos.photo,function(o){return new n(o)});e.images(a)}clearTimeout(t)},error:function(o){console.log("error:",o)}}).done(function(o){}).fail(function(o){console.log("fail, response:",o)}).always(function(o){})};e.location=ko.observable(p),e.oldLocation=p,e.groups=ko.observableArray([]),e.images=ko.observableArray([]),e.showGroups=ko.observable(!1),e.toggleShowGroups=function(){e.showGroups(!e.showGroups())},e.removeMarkers=function(){},e.goIsEnabled=ko.observable(!1),e.evalGoEnabled=function(){return console.log("self.location():",e.location()),e.goIsEnabled(e.location()!==e.oldLocation),!0},e.goLocation=function(){e.oldLocation=e.location(),e.evalGoEnabled(),e.toggleShowGroups(),i()},e.query=ko.observable(""),e.meetupSelected=ko.observable(),e.search=ko.computed(function(){return console.log("search:"),g=ko.utils.arrayFilter(e.groups(),function(o){return o.name.toLowerCase().indexOf(e.query().toLowerCase())>=0?(console.log("visible group.marker:",o.marker),"undefined"!=typeof o.marker&&o.marker.setVisible(!0),o):(console.log("invisible group.marker:",o.marker),"undefined"!=typeof o.marker&&o.marker.setVisible(!1),c.close(),void 0)})}),i()}var s,r,l,c,g,p="minneapolis",m=11;google.maps.event.addDomListener(window,"load",t),window.addEventListener("load",function(o){l=new i,ko.applyBindings(l)}),$(function(){console.log("jquery ready, map:",s);var o=$("#container-data"),e=$("#container-images"),t=$(o.find(".tab-search")[0]),n=$(e.find(".tab-images")[0]),a=$(o.find(".icon-circle-left")[0]),i=$(e.find(".icon-circle-down")[0]),r=a.attr("class"),l=i.attr("class");t.click(function(e){var t,n,i="";i+=o.hasClass("extend")?" extend":"",i+=o.hasClass("retract")?" retract":"",o.hasClass("open")?(t="close"+i,n=r+" rotate"):(t="open"+i,n=r+" unrotate"),o.attr("class",t),a.attr("class",n)}),n.click(function(t){var n,a,s,r;!e.attr("class")||e.hasClass("open")?(n="close",a=l+" rotate",s="extend",r="retract"):(n="open",a=l+" unrotate",s="retract",r="extend"),o.removeClass(r).addClass(s),e.attr("class",n),i.attr("class",a)})}),a.prototype.addMarker=function(o,e){var t=this;window.setTimeout(function(){t.marker=new google.maps.Marker({position:t.location,title:t.name,map:s,mid:o+e,animation:google.maps.Animation.DROP});t.strContent;t.marker.addListener("click",function(){t.triggerMarker()})},e)},a.prototype.stopMarkerAnimation=function(){null!==this.marker.getAnimation()&&this.marker.setAnimation(null)},a.prototype.triggerMarker=function(t,n){console.log("triggerMarker, this:",this),console.log("triggerMarker, item:",t),console.log("triggerMarker, e:",n),l.meetupSelected(this),n||document.getElementById(this.id).scrollIntoView(),null!==this.marker.getAnimation()?this.marker.setAnimation(null):(this.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(this.stopMarkerAnimation.bind(this),2150)),s.panTo(this.location);var a=o();s.panBy(a.offsetX,a.offsetY),c.setOptions({maxWidth:e()}),c.setContent(this.strContent),console.log("infoWindow:",c),c.open(s,this.marker)},a.prototype.removeMarker=function(){this.marker.setMap(null)}}();