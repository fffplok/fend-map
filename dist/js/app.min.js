!function(){"use strict";function e(){var e=document.getElementById("container-data"),t=document.getElementById("container-images"),o=e.getBoundingClientRect().left>=0?-e.clientWidth/2:0,n=t.getBoundingClientRect().height>0?t.clientHeight/2:0;return{offsetX:o,offsetY:n}}function t(){var e=document.getElementById("container-data"),t=e.getBoundingClientRect().left>=0?e.clientWidth:0,o=Math.max(document.documentElement.clientWidth,window.innerWidth);return console.log("getWidthInfoWin, w, oX:",o,t),o-t-110}function o(){var e=document.getElementById("map-canvas"),t={zoom:f,center:{lat:44.963324,lng:-93.26832},disableDefaultUI:!0};r=new google.maps.Geocoder,c=new google.maps.InfoWindow({content:""}),google.maps.event.addListener(c,"closeclick",function(){l.meetupSelected(null)}),s=new google.maps.Map(e,t)}function n(e){this.src="https://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+".jpg",this.title=e.title}function i(e,t){var o="m",n=200*t;this.name=e.name,this.city=e.city,this.id=o+n,this.description=e.description,this.marker,this.location={lat:e.lat,lng:e.lon},this.urlThumb=e.group_photo?e.group_photo.thumb_link:"img/not_available.svg",this.photos=e.photos?e.photos:[],this.strContent="<img src="+this.urlThumb+" title="+this.name+" alt="+this.name+">",this.strContent+="<h4>"+this.name+"</h4>",this.strContent+="<div>"+this.description+"</div>",this.addMarker(o,n)}function a(){var t=this,o=setTimeout(function(){console.log("failed to get meetup resources")},8e3),a=function(){$.ajax({url:"https://api.meetup.com/find/groups?key=617467255c2e7b9d7a1c7d1646a20&photo-host=public&location='"+t.location()+"'&page=20&sign=true",dataType:"jsonp",success:function(n){if(console.log("getMeetups success, self.location(), response.data:",t.location(),n.data),t.groups().length>0)for(;t.groups().length>0;)t.groups().shift().removeMarker();var a=$.map(n.data,function(e,t){return new i(e,t)});t.groups(a),t.toggleShowGroups(),r.geocode({address:t.location()},function(t,o){if(o===google.maps.GeocoderStatus.OK){s.setCenter(t[0].geometry.location),s.setZoom(f);var n=e();s.panBy(n.offsetX,n.offsetY),l()}else alert("Geocode was not successful for the following reason: "+o)}),clearTimeout(o)},error:function(e){console.log("error:",e)}}).done(function(e){}).fail(function(e){console.log("fail, response:",e)}).always(function(e){})},l=function(){$.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=705d79e848f4e7dad9f9f119378b199f&lat="+s.getCenter().lat()+"&lon="+s.getCenter().lng()+"&per_page=20&format=json&nojsoncallback=1",success:function(e){if(console.log("getImages success, self.location(), response:",t.location(),e),"ok"===e.stat){$("#slides");if(t.images().length>0)for(;t.images().length>0;)t.images().shift();var i=$.map(e.photos.photo,function(e){return new n(e)});t.images(i)}clearTimeout(o)},error:function(e){console.log("error:",e)}}).done(function(e){}).fail(function(e){console.log("fail, response:",e)}).always(function(e){})};t.location=ko.observable(d),t.oldLocation=d,t.groups=ko.observableArray([]),t.images=ko.observableArray([]),t.showGroups=ko.observable(!1),t.toggleShowGroups=function(){t.showGroups(!t.showGroups())},t.removeMarkers=function(){},t.goIsEnabled=ko.observable(!1),t.evalGoEnabled=function(){return console.log("self.location():",t.location()),t.goIsEnabled(t.location()!==t.oldLocation),!0},t.goLocation=function(){t.oldLocation=t.location(),t.evalGoEnabled(),t.toggleShowGroups(),a()},t.query=ko.observable(""),t.meetupSelected=ko.observable(),t.search=ko.computed(function(){return console.log("search:"),u=ko.utils.arrayFilter(t.groups(),function(e){return e.name.toLowerCase().indexOf(t.query().toLowerCase())>=0?(console.log("visible group.marker:",e.marker),"undefined"!=typeof e.marker&&e.marker.setVisible(!0),e):(console.log("invisible group.marker:",e.marker),"undefined"!=typeof e.marker&&e.marker.setVisible(!1),c.close(),void 0)})}),a()}var s,r,l,c,u,d="minneapolis",f=11,m=!0;google.maps.event.addDomListener(window,"load",o),window.addEventListener("load",function(e){l=new a,ko.applyBindings(l)}),$(function(){console.log("jquery ready, map:",s);var e=$("#container-data"),t=$("#container-images"),o=$(e.find(".tab-search")[0]),n=$(t.find(".tab-images")[0]),i=$(e.find(".icon-circle-left")[0]),a=$(t.find(".icon-circle-down")[0]),r=i.attr("class"),l=a.attr("class");if(m){var c=$("#debug");c.html("debug here.")}o.click(function(t){var o,n,a="";if(m){var s="#container-data width: "+e.width(),l=".container-search width: "+e.find(".container-search").width(),u=".container-flex width: "+e.find(".container-flex").width(),d="text input flex: "+$(e.find("input")[0]).css("flex");c.html(s+"<br>"+l+"<br>"+u+"<br>"+d)}a+=e.hasClass("extend")?" extend":"",a+=e.hasClass("retract")?" retract":"",!e.attr("class")||e.hasClass("slideInLeft")?(o="slideOutLeft"+a,n=r+" rotate"):(o="slideInLeft"+a,n=r+" unrotate"),e.attr("class",o),i.attr("class",n)}),n.click(function(o){var n,i,s,r;!t.attr("class")||t.hasClass("open")?(n="close",i=l+" rotate",s="extend",r="retract"):(n="open",i=l+" unrotate",s="retract",r="extend"),e.removeClass(r).addClass(s),t.attr("class",n),a.attr("class",i)})}),i.prototype.addMarker=function(e,t){var o=this;window.setTimeout(function(){o.marker=new google.maps.Marker({position:o.location,title:o.name,map:s,mid:e+t,animation:google.maps.Animation.DROP});o.strContent;o.marker.addListener("click",function(){o.triggerMarker()})},t)},i.prototype.stopMarkerAnimation=function(){null!==this.marker.getAnimation()&&this.marker.setAnimation(null)},i.prototype.triggerMarker=function(o,n){l.meetupSelected(this),n||document.getElementById(this.id).scrollIntoView(),null!==this.marker.getAnimation()?this.marker.setAnimation(null):(this.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(this.stopMarkerAnimation.bind(this),2150)),s.panTo(this.location);var i=e();s.panBy(i.offsetX,i.offsetY),c.setOptions({maxWidth:t()}),c.setContent(this.strContent),console.log("infoWindow:",c),c.open(s,this.marker)},i.prototype.removeMarker=function(){this.marker.setMap(null)}}();