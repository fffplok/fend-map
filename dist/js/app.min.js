!function(){"use strict";function o(){var o=document.getElementById("map-canvas"),e={zoom:p,center:{lat:44.963324,lng:-93.26832},panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT,position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.HYBRID],style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!1,streetViewControl:!1,overviewMapControl:!1};s=new google.maps.Geocoder,i=new google.maps.InfoWindow({content:""}),a=new google.maps.Map(o,e)}function e(o){this.src="https://farm"+o.farm+".staticflickr.com/"+o.server+"/"+o.id+"_"+o.secret+".jpg",this.title=o.title}function t(o,e){this.name=o.name,this.city=o.city,this.description=o.description,this.marker,this.location={lat:o.lat,lng:o.lon},this.urlThumb=o.group_photo?o.group_photo.thumb_link:"img/not_available.svg",this.photos=o.photos?o.photos:[],this.strContent="<img src="+this.urlThumb+" title="+this.name+" alt="+this.name+">",this.strContent+="<h4>"+this.name+"</h4>",this.strContent+="<div>"+this.description+"</div>",this.addMarker(200*e)}function n(){var o=this,n=setTimeout(function(){console.log("failed to get meetup resources")},8e3),r=function(){$.ajax({url:"https://api.meetup.com/find/groups?key=617467255c2e7b9d7a1c7d1646a20&photo-host=public&location='"+o.location()+"'&page=20&sign=true",dataType:"jsonp",success:function(e){if(console.log("getMeetups success, self.location(), response.data:",o.location(),e.data),o.groups().length>0)for(;o.groups().length>0;)o.groups().shift().removeMarker();var r=$.map(e.data,function(o,e){return new t(o,e)});o.groups(r),o.toggleShowGroups(),s.geocode({address:o.location()},function(o,e){e===google.maps.GeocoderStatus.OK?(a.setCenter(o[0].geometry.location),a.setZoom(p),g()):alert("Geocode was not successful for the following reason: "+e)}),clearTimeout(n)},error:function(o){console.log("error:",o)}}).done(function(o){}).fail(function(o){console.log("fail, response:",o)}).always(function(o){})},g=function(){$.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=705d79e848f4e7dad9f9f119378b199f&lat="+a.getCenter().lat()+"&lon="+a.getCenter().lng()+"&per_page=20&format=json&nojsoncallback=1",success:function(t){if(console.log("getImages success, self.location(), response:",o.location(),t),"ok"===t.stat){$("#slides");if(o.images().length>0)for(;o.images().length>0;)o.images().shift();var a=$.map(t.photos.photo,function(o){return new e(o)});o.images(a)}clearTimeout(n)},error:function(o){console.log("error:",o)}}).done(function(o){}).fail(function(o){console.log("fail, response:",o)}).always(function(o){})};o.location=ko.observable(c),o.oldLocation=c,o.groups=ko.observableArray([]),o.images=ko.observableArray([]),o.showGroups=ko.observable(!1),o.toggleShowGroups=function(){o.showGroups(!o.showGroups())},o.removeMarkers=function(){},o.goIsEnabled=ko.observable(!1),o.evalGoEnabled=function(){return console.log("self.location():",o.location()),o.goIsEnabled(o.location()!==o.oldLocation),!0},o.goLocation=function(){o.oldLocation=o.location(),o.evalGoEnabled(),o.toggleShowGroups(),r()},o.query=ko.observable(""),o.search=ko.computed(function(){return console.log("search:"),l=ko.utils.arrayFilter(o.groups(),function(e){return e.name.toLowerCase().indexOf(o.query().toLowerCase())>=0?(console.log("visible group.marker:",e.marker),"undefined"!=typeof e.marker&&e.marker.setVisible(!0),e):(console.log("invisible group.marker:",e.marker),"undefined"!=typeof e.marker&&e.marker.setVisible(!1),i.close(),void 0)})}),r()}var a,s,r,i,l,c="minneapolis",p=11;google.maps.event.addDomListener(window,"load",o),window.addEventListener("load",function(o){r=new n,ko.applyBindings(r)}),$(function(){console.log("jquery ready, map:",a);var o=$("#container-data"),e=$("#container-images"),t=$(o.find(".tab-search")[0]),n=$(e.find(".tab-images")[0]),s=$(o.find(".icon-circle-left")[0]),r=$(e.find(".icon-circle-down")[0]),i=s.attr("class"),l=r.attr("class");t.click(function(e){var t,n,a="";a+=o.hasClass("extend")?" extend":"",a+=o.hasClass("retract")?" retract":"",o.hasClass("open")?(t="close"+a,n=i+" rotate"):(t="open"+a,n=i+" unrotate"),o.attr("class",t),s.attr("class",n)}),n.click(function(t){var n,a,s,i;!e.attr("class")||e.hasClass("open")?(n="close",a=l+" rotate",s="extend",i="retract"):(n="open",a=l+" unrotate",s="retract",i="extend"),o.removeClass(i).addClass(s),e.attr("class",n),r.attr("class",a)})}),t.prototype.addMarker=function(o){var e=this;window.setTimeout(function(){e.marker=new google.maps.Marker({position:e.location,title:e.name,map:a,animation:google.maps.Animation.DROP});e.strContent;e.marker.addListener("click",function(){e.triggerMarker()})},o)},t.prototype.stopMarkerAnimation=function(){null!==this.marker.getAnimation()&&this.marker.setAnimation(null)},t.prototype.triggerMarker=function(){console.log("triggerMarker, this:",this);null!==this.marker.getAnimation()?this.marker.setAnimation(null):(this.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(this.stopMarkerAnimation.bind(this),2150)),a.panTo(this.location),i.setContent(this.strContent),i.open(a,this.marker)},t.prototype.removeMarker=function(){this.marker.setMap(null)}}();