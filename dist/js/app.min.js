!function(){"use strict";function e(){var e=f.getBoundingClientRect().left>=0?-f.clientWidth/2:0,t=d.getBoundingClientRect().height>0?d.clientHeight/2:0;return{offsetX:e,offsetY:t}}function t(){var e=f.getBoundingClientRect().left>=0?f.clientWidth:0,t=Math.max(document.documentElement.clientWidth,window.innerWidth);return t-e-110}function o(e){var t=$.Deferred();return c.geocode({address:e},function(e,o){o===google.maps.GeocoderStatus.OK?t.resolve(e[0].geometry.location):t.reject(o)}),t}function a(){c=new google.maps.Geocoder;var e=document.getElementById("map-canvas"),t={zoom:k,disableDefaultUI:!0};p=new google.maps.InfoWindow({content:""}),google.maps.event.addListener(p,"closeclick",function(){m.meetupSelected(null)}),l=new google.maps.Map(e,t),m=new s,ko.applyBindings(m),m.goLocation()}function n(){u=setTimeout(function(){console.log("failed to get meetup resources, request timed out"),alert("failed to get meetup resources, request timed out")},8e3)}function s(){var t=this;t.location=ko.observable(h).extend({filterInput:0}),t.oldLocation="",t.groups=ko.observableArray([]),t.showGroups=ko.observable(!1),t.images=ko.observableArray([]),t.query=ko.observable(""),t.meetupSelected=ko.observable(),t.mapUnfound=ko.observable(!1),t.mapMessageVisible=ko.observable(!1),t.mapMessage=ko.observable(""),t.imagesMessage=ko.observable(""),t.meetupsMessage=ko.observable(""),t.iconAlert='<svg class="icon icon-alert"><use xlink:href="#icon-alert"></use></svg>',t.emptyImages=function(){var e=t.images();if(e.length>0){for(;e.length>0;)e.shift();t.images.valueHasMutated()}},t.getImages=function(){$.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=705d79e848f4e7dad9f9f119378b199f&text="+t.location()+"&sort=relevance&per_page=20&format=json&nojsoncallback=1",dataType:"json",success:function(e){if(t.imagesMessage(""),"ok"===e.stat){t.emptyImages();var o=$.map(e.photos.photo,function(e){return new i(e)});t.images(o)}0===t.images().length&&t.imagesMessage("No images were found for "+t.location()+"."+t.iconAlert)},error:function(e){t.imagesMessage("Unable to load images for "+t.location()+", error: "+e+"."+t.iconAlert)}})},t.emptyGroups=function(){var e=t.groups();if(e.length>0){for(;e.length>0;)e.shift().removeMarker();t.groups.valueHasMutated()}},t.getMeetups=function(){$.ajax({url:"https://api.meetup.com/find/groups?key=617467255c2e7b9d7a1c7d1646a20&photo-host=public&location='"+t.location()+"'&page=20&sign=true",dataType:"jsonp",success:function(e){t.meetupsMessage(""),t.emptyGroups();var o=l.getCenter(),a={lat:Number(o.lat()),lng:Number(o.lng())};if(e.data.length){var n={lat:Number(e.data[0].lat),lng:Number(e.data[0].lon)};if(Math.abs(a.lat-n.lat)<7&&Math.abs(a.lng-n.lng)<7){var s=$.map(e.data,function(e,t){return new r(e,t)});t.groups(s)}else t.meetupsMessage("No meetups were found for "+t.location()+"."+t.iconAlert)}0===t.groups().length&&t.meetupsMessage("No meetups were found for "+t.location()+"."+t.iconAlert),t.toggleShowGroups(),clearTimeout(u)},error:function(e){t.meetupsMessage("Unable to load Meetups for "+t.location()+", error: "+e.status+"."+t.iconAlert)}})},t.toggleShowGroups=function(){t.showGroups(!t.showGroups())},t.evalGoLocation=function(e,o){13==o.keyCode&&t.goLocation()},t.goLocation=function(){var a=t.location();""!==a&&t.oldLocation!==a&&(t.oldLocation=a,t.showGroups(!1),o(t.location()).then(function(o){t.mapMessageVisible(!1),l.setCenter(o),l.setZoom(k);var a=e();l.panBy(a.offsetX,a.offsetY),t.query(""),n(),t.mapMessage(""),t.mapUnfound(!1),t.getMeetups(),t.getImages()},function(e){t.emptyGroups(),t.emptyImages(),t.mapMessage("Unable to find map for "+t.location()+". "+e+t.iconAlert),t.mapMessageVisible(!0),t.mapUnfound(!0),t.meetupsMessage("No search can be done for meetups at "+t.location()+"."+t.iconAlert),t.imagesMessage("No search can be done for images at "+t.location()+"."+t.iconAlert)}))},t.search=ko.computed(function(){return g=ko.utils.arrayFilter(t.groups(),function(e){if(e.name){if(e.name.toLowerCase().indexOf(t.query().toLowerCase())>=0)return"undefined"!=typeof e.marker&&e.marker.setVisible(!0),e;"undefined"!=typeof e.marker&&e.marker.setVisible(!1),p.close(),t.meetupSelected(null)}})})}function i(e){this.src="https://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+".jpg",this.title=e.title}function r(e,t){var o="m",a=100*t;this.name=e.name,this.city=e.city,this.id=o+a,this.description=e.description,this.marker,this.location={lat:e.lat,lng:e.lon},this.urlThumb=e.group_photo?e.group_photo.thumb_link:"img/not_available.svg",this.photos=e.photos?e.photos:[],this.strContent="<img src="+this.urlThumb+" title="+this.name+" alt="+this.name+">",this.strContent+="<h4>"+this.name+"</h4>",this.strContent+="<div>"+this.description+"</div>",this.addMarker(o,a)}var l,c,u,m,p,g,f,d,h="Minneapolis",k=11;ko.extenders.filterInput=function(e,t){var o=ko.pureComputed({read:e,write:function(t){var o=e(),a=t.replace(/[~!@#$%^&*()_+=`?><.:;|•¥¥€£'"\-\{\}\[\]\/\\^0-9]/,"");a!==o?e(a):t!==o&&e.notifySubscribers(a)}}).extend({notify:"always"});return o(e()),o},google.maps.event.addDomListener(window,"load",a),$(function(){var e=$("#container-data"),t=$("#container-images"),o=$(e.find(".tab-search")[0]),a=$(t.find(".tab-images")[0]),n=$(e.find(".icon-circle-left")[0]),s=$(t.find(".icon-circle-down")[0]),i=n.attr("class"),r=s.attr("class");f=e[0],d=t[0],o.click(function(t){var o,a,s="";s+=e.hasClass("extend")?" extend":"",s+=e.hasClass("retract")?" retract":"",!e.attr("class")||e.hasClass("slideInLeft")?(o="slideOutLeft"+s,a=i+" rotate"):(o="slideInLeft"+s,a=i+" unrotate"),e.attr("class",o),n.attr("class",a)}),a.click(function(o){var a,n,i,l;!t.attr("class")||t.hasClass("open")?(a="close",n=r+" rotate",i="extend",l="retract"):(a="open",n=r+" unrotate",i="retract",l="extend"),e.removeClass(l).addClass(i),t.attr("class",a),s.attr("class",n)})}),r.prototype.addMarker=function(e,t){var o=this;window.setTimeout(function(){o.marker=new google.maps.Marker({position:o.location,title:o.name,map:l,mid:e+t,animation:google.maps.Animation.DROP}),o.marker.addListener("click",function(){o.triggerMarker()})},t)},r.prototype.stopMarkerAnimation=function(){null!==this.marker.getAnimation()&&this.marker.setAnimation(null)},r.prototype.triggerMarker=function(o,a){m.meetupSelected(this),a||document.getElementById(this.id).scrollIntoView(),null!==this.marker.getAnimation()?this.marker.setAnimation(null):(this.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(this.stopMarkerAnimation.bind(this),2150)),l.panTo(this.location);var n=e();l.panBy(n.offsetX,n.offsetY),p.setOptions({maxWidth:t()}),p.setContent(this.strContent),p.open(l,this.marker)},r.prototype.removeMarker=function(){this.marker.setMap(null)}}();